import os
import pefile

def glorySprout_hashing(function_name):
    hash = 0
    for c in function_name:
        hash = (hash << 0x4) + c
        c = (hash) & 0xF0000000
        if c & 0xF0000000 != 0:
            c = c >> 0x18
            hash = (hash ^ c ) & 0xFFFFFFF
    return hex(hash)

filter = ['advapi32.dll']
    
def get_all_export_function_from_dlls():
    exported_func = {}
    for dirpath, dirnames, filenames in os.walk("C:\\Windows\\System32"):
        for filename in [f for f in filenames if f in filter]:
            path_to_dll = os.path.join(dirpath, filename)
            pe = pefile.PE(path_to_dll)
            for export in pe.DIRECTORY_ENTRY_EXPORT.symbols:
                if not export.name:
                    continue
                else:
                    exported_func[glorySprout_hashing(export.name)] = export.name
    return exported_func

get_all_export_function_from_dlls()
